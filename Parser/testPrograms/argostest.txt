(begin
(include functions.txt)
(var global reactive leftWheelVelocity)
(var global reactive rightWheelVelocity)
(var global reactive robotID)
(var global reactive distance_covered)
(var global reactive speed)
(var global reactive barrierChecker)
(var tagged inert finalSpeed)

(var global inert barrierComplete)
(set barrierComplete 0)
(var global inert barrierSum)
(var map reactive barrier)

(fun reactive checkBarrier () (begin 
    (var local inert barrierSum)
    (set barrierSum 0)
    (foreach inert (in i barrier') (set barrierSum (+ barrierSum i)))
    (if (> barrierSum 4) (set barrierComplete 1) 0)))

(var local inert total_distance)
(set total_distance 40)
(set distance_covered (get_distance_covered))
(set barrier (if (>= distance_covered' total_distance) 1 0))
(set barrierChecker (checkBarrier))
(set speed (if (>= distance_covered' total_distance) (if (! barrierComplete) 0 finalSpeed) (* (+ (% robotID 5) 2) 2)))
(set finalSpeed speed)
(set leftWheelVelocity speed')
(set rightWheelVelocity speed')
(spin)
(fun reactive step () (set distance_covered (get_distance_covered))))